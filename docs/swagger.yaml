basePath: /
definitions:
  model.AddNodeReq:
    properties:
      ip:
        example: 192.168.101.108
        type: string
      shard:
        example: 3
        type: integer
    type: object
  model.AlterCkTableReq:
    properties:
      add:
        items:
          $ref: '#/definitions/model.CkTableNameTypeAfter'
        type: array
      database:
        example: default
        type: string
      drop:
        example:
        - age
        items:
          type: string
        type: array
      modify:
        items:
          $ref: '#/definitions/model.CkTableNameType'
        type: array
      name:
        example: test_table
        type: string
    type: object
  model.CkDeployConfig:
    properties:
      ckTcpPort:
        example: 9000
        type: integer
      clusterName:
        example: test
        type: string
      packageVersion:
        example: 20.8.5.45
        type: string
      password:
        example: "123456"
        type: string
      path:
        example: /data01/
        type: string
      shards:
        items:
          $ref: '#/definitions/model.CkShard'
        type: array
      user:
        example: ck
        type: string
      zkNodes:
        example:
        - 192.168.101.102
        - 192.168.101.105
        - 192.168.101.107
        items:
          type: string
        type: array
      zkPort:
        example: 2181
        type: integer
    type: object
  model.CkImportConfig:
    properties:
      cluster:
        example: test
        type: string
      hosts:
        example:
        - 192.168.101.105
        - 192.168.101.107
        items:
          type: string
        type: array
      password:
        example: "123456"
        type: string
      port:
        example: 9000
        type: integer
      user:
        example: ck
        type: string
      zkNodes:
        example:
        - 192.168.101.102
        - 192.168.101.105
        - 192.168.101.107
        items:
          type: string
        type: array
      zkPort:
        example: 2181
        type: integer
    type: object
  model.CkReplica:
    properties:
      ip:
        example: 192.168.101.105
        type: string
    type: object
  model.CkShard:
    properties:
      replicas:
        items:
          $ref: '#/definitions/model.CkReplica'
        type: array
    type: object
  model.CkTableNameType:
    properties:
      name:
        example: _timestamp
        type: string
      type:
        example: DateTime
        type: string
    type: object
  model.CkTableNameTypeAfter:
    properties:
      after:
        example: _timestamp
        type: string
      name:
        example: age
        type: string
      type:
        example: Int32
        type: string
    type: object
  model.CkTablePartition:
    properties:
      name:
        example: _timestamp
        type: string
      policy:
        description: |-
          0 split partition by day
          1 split partition by week
          2 split partition by month
        example: 0
        type: integer
    type: object
  model.CreateCkTableReq:
    properties:
      database:
        example: default
        type: string
      fields:
        items:
          $ref: '#/definitions/model.CkTableNameType'
        type: array
      name:
        example: test_table
        type: string
      order:
        example:
        - _timestamp
        items:
          type: string
        type: array
      partition:
        $ref: '#/definitions/model.CkTablePartition'
    type: object
  model.DeployCkReq:
    properties:
      clickhouse:
        $ref: '#/definitions/model.CkDeployConfig'
      hosts:
        example:
        - 192.168.101.105
        items:
          type: string
        type: array
      password:
        example: "123456"
        type: string
      user:
        example: root
        type: string
    type: object
  model.LoginReq:
    properties:
      password:
        example: 63cb91a2ceb9d4f7c8b1ba5e50046f52
        type: string
      username:
        example: ckman
        type: string
    type: object
  model.UpdateConfigReq:
    properties:
      alertManagers:
        example:
        - 192.168.101.105:19093
        items:
          type: string
        type: array
      peers:
        example:
        - 192.168.21.74
        items:
          type: string
        type: array
      prometheus:
        example:
        - 192.168.101.105:19090
        items:
          type: string
        type: array
    type: object
info:
  contact: {}
  title: Swagger Example API
  version: "1.0"
paths:
  /api/login:
    post:
      description: 登陆
      parameters:
      - description: request body
        in: body
        name: req
        required: true
        schema:
          $ref: '#/definitions/model.LoginReq'
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":{"username":"ckman","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"}}'
          schema:
            type: string
      summary: 登陆
  /api/logout:
    put:
      description: 退出登陆
      responses:
        "200":
          description: '{"code":200,"msg":"success","data":nil}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 退出登陆
  /api/v1/ck/cluster:
    get:
      description: 获取ClickHouse集群
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":{"test":{"hosts":["192.168.101.105"],"port":9000,"user":"eoi","password":"123456","database":"default","cluster":"test","zkNodes":["192.168.101.102"],"zkPort":2181,"isReplica":false}}}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 获取ClickHouse集群
    post:
      description: 导入ClickHouse集群
      parameters:
      - description: request body
        in: body
        name: req
        required: true
        schema:
          $ref: '#/definitions/model.CkImportConfig'
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 导入ClickHouse集群
    put:
      description: 更新ClickHouse集群
      parameters:
      - description: request body
        in: body
        name: req
        required: true
        schema:
          $ref: '#/definitions/model.CkImportConfig'
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 更新ClickHouse集群
  /api/v1/ck/cluster/{clusterName}:
    delete:
      description: 删除ClickHouse集群
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 删除ClickHouse集群
  /api/v1/ck/destroy/{clusterName}:
    put:
      description: 销毁ClickHouse集群
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"success","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 销毁ClickHouse集群
  /api/v1/ck/get/{clusterName}:
    get:
      description: 获取ClickHouse集群信息
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"success","data":{"status":"green","version":"20.8.5.45","nodes":[{"ip":"192.168.101.105","hostname":"vm101105","status":"green"}]}}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 获取ClickHouse集群信息
  /api/v1/ck/node/{clusterName}:
    delete:
      description: 删除ClickHouse集群节点
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      - default: 192.168.101.105
        description: node ip address
        in: query
        name: ip
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"success","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 删除ClickHouse集群节点
    post:
      description: 添加ClickHouse集群节点
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      - description: request body
        in: body
        name: req
        required: true
        schema:
          $ref: '#/definitions/model.AddNodeReq'
      responses:
        "200":
          description: '{"code":200,"msg":"success","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 添加ClickHouse集群节点
  /api/v1/ck/open_sessions/{clusterName}:
    get:
      description: 获取ClickHouse正在执行的查询
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      - default: "10"
        description: sessions limit
        in: query
        name: limit
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":[{"startTime":1609997894,"queryDuration":1,"query":"SELECT DISTINCT name FROM system.tables","user":"eoi","queryId":"62dce71d-9294-4e47-9d9b-cf298f73233d","address":"192.168.21.73","threads":2}]}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 获取ClickHouse正在执行的查询
  /api/v1/ck/query/{clusterName}:
    get:
      description: 执行query命令
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      - default: show databases
        description: sql
        in: query
        name: query
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":[["name"],["default"],["system"]]}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 执行query命令
  /api/v1/ck/rebalance/{clusterName}:
    put:
      description: 均衡ClickHouse集群
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"success","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 均衡ClickHouse集群
  /api/v1/ck/slow_sessions/{clusterName}:
    get:
      description: 获取ClickHouse慢查询
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      - default: "10"
        description: sessions limit
        in: query
        name: limit
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":[{"startTime":1609986493,"queryDuration":145,"query":"select * from dist_sensor_dt_result_online limit 10000","user":"default","queryId":"8aa3de08-92c4-4102-a83d-2f5d88569dab","address":"::1","threads":2}]}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 获取ClickHouse慢查询
  /api/v1/ck/start/{clusterName}:
    put:
      description: 启动ClickHouse集群
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"success","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 启动ClickHouse集群
  /api/v1/ck/stop/{clusterName}:
    put:
      description: 停止ClickHouse集群
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"success","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 停止ClickHouse集群
  /api/v1/ck/table/{clusterName}:
    delete:
      description: 删除表
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      - default: default
        description: database name
        in: query
        name: database
        required: true
        type: string
      - default: test_table
        description: table name
        in: query
        name: tableName
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 删除表
    get:
      description: 描述表
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      - default: default
        description: database name
        in: query
        name: database
        required: true
        type: string
      - default: test_table
        description: table name
        in: query
        name: tableName
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":[{"name":"_timestamp","type":"DateTime","defaultType":"","defaultExpression":"","comment":"","codecExpression":"","ttlExpression":""}]}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 描述表
    post:
      description: 创建表
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      - description: request body
        in: body
        name: req
        required: true
        schema:
          $ref: '#/definitions/model.CreateCkTableReq'
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 创建表
    put:
      description: 修改表
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      - description: request body
        in: body
        name: req
        required: true
        schema:
          $ref: '#/definitions/model.AlterCkTableReq'
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 修改表
  /api/v1/ck/table_metric/{clusterName}:
    get:
      description: 获取ClickHouse中MergeTree表的指标
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":{"sensor_dt_result_online":{"columns":22,"rows":1381742496,"parts":192,"space":54967700946,"completedQueries":5,"failedQueries":0,"queryCost":{"middle":130,"secondaryMax":160.76,"max":162}}}}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 获取ClickHouse中MergeTree表的指标
  /api/v1/ck/upgrade/{clusterName}:
    put:
      description: 升级ClickHouse集群
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      - default: 20.8.5.45
        description: package version
        in: query
        name: packageVersion
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"success","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 升级ClickHouse集群
  /api/v1/config:
    get:
      description: 获取配置
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":{"peers":null,"prometheus":["192.168.101.105:19090"],"alertManagers":null}}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 获取配置
    put:
      description: 更新配置
      parameters:
      - description: request body
        in: body
        name: req
        required: true
        schema:
          $ref: '#/definitions/model.UpdateConfigReq'
      responses:
        "200":
          description: '{"code":200,"msg":"success","data":nil}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 更新配置
  /api/v1/deploy/ck:
    post:
      description: 部署clickhouse
      parameters:
      - description: request body
        in: body
        name: req
        required: true
        schema:
          $ref: '#/definitions/model.DeployCkReq'
      responses:
        "200":
          description: '{"code":200,"msg":"success","data":nil}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 部署clickhouse
  /api/v1/metric/query:
    get:
      description: 查询指标
      parameters:
      - default: ClickHouseMetrics_Read
        description: metric name
        in: query
        name: metric
        required: true
        type: string
      - default: "1606290000"
        description: metric time
        in: query
        name: time
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":[{"metric":{"__name__":"ClickHouseMetrics_Read","instance":"192.168.101.105:9363","job":"clickhouse_exporter"},"value":[1606290000,"2"]}]}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 查询指标
  /api/v1/metric/query_range:
    get:
      description: 查询指标范围
      parameters:
      - default: ClickHouseMetrics_Read
        description: metric name
        in: query
        name: metric
        required: true
        type: string
      - default: "1606290000"
        description: start time
        in: query
        name: start
        required: true
        type: string
      - default: "1606290120"
        description: end time
        in: query
        name: end
        required: true
        type: string
      - default: "60"
        description: step window
        in: query
        name: step
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":[{"metric":{"__name__":"ClickHouseMetrics_Read","instance":"192.168.101.105:9363","job":"clickhouse_exporter"},"values":[[1606290000,"2"],[1606290060,"2"],[1606290120,"2"]]}]}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 查询指标范围
  /api/v1/package:
    delete:
      description: 删除包
      parameters:
      - default: 20.8.5.45
        description: package version
        in: query
        name: packageVersion
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"success","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 删除包
    get:
      description: 获取安装包列表
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":["20.8.5.45"]}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 获取安装包列表
    post:
      consumes:
      - multipart/form-data
      description: 上传安装包
      parameters:
      - description: 安装包
        in: formData
        name: package
        required: true
        type: file
      responses:
        "200":
          description: '{"code":200,"msg":"success","data":null}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 上传安装包
  /api/v1/zk/replicated_table/{clusterName}:
    get:
      description: 从Zookeeper中获取复制表状态
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":{"header":[["vm101106","vm101108"],["vm102114","vm101110"],["vm102116","vm102115"]],"tables":[{"name":"sensor_dt_result_online","values":[["l1846","f1846"],["l1845","f1845"],["l1846","f1846"]]}]}}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 从Zookeeper中获取复制表状态
  /api/v1/zk/status/{clusterName}:
    get:
      description: 获取Zookeeper集群状态
      parameters:
      - default: test
        description: cluster name
        in: path
        name: clusterName
        required: true
        type: string
      responses:
        "200":
          description: '{"code":200,"msg":"ok","data":[{"host":"192.168.102.116","version":"3.6.2","server_state":"follower","peer_state":"following - broadcast","avg_latency":0.4929,"approximate_data_size":141979,"znode_count":926}]}'
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 获取Zookeeper集群状态
securityDefinitions:
  ApiKeyAuth:
    in: header
    name: token
    type: apiKey
swagger: "2.0"
