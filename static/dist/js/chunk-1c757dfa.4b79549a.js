(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1c757dfa"],{"63a1":function(e,t,n){},"933a":function(e,t,n){"use strict";var a=n("63a1"),r=n.n(a);r.a},c308:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("main",{staticClass:"settings"},[n("breadcrumb",{attrs:{data:["Clusters",e.$route.params.id,"manage"]},scopedSlots:e._u([{key:"default",fn:function(){return e._l(e.clusterStatus,(function(t){return n("el-button",{key:t,staticClass:"fs-14",attrs:{type:"primary",size:"mini",disabled:e.isStatusDisable(t)},on:{click:function(n){return e.clusterOptation(t)}}},[e._v(e._s(e.$t("manage."+t+" Cluster")))])}))},proxy:!0}])}),n("section",{staticClass:"container"},[n("div",{staticClass:"uprade ptb-15"},[n("span",{staticClass:"fs-18 font-bold mb-15 inline-block"},[e._v(e._s(e.$t("manage.Upgrade Cluster")))]),n("div",{},[n("span",{staticClass:"fs-14 font-bold"},[e._v(e._s(e.$t("home.ClickHouse Version"))+": "+e._s(e.list.version))]),"deploy"===e.mode?n("span",{staticClass:"fs-14 font-bold ml-50"},[e._v(e._s(e.$t("manage.Upgrade to"))+":")]):e._e(),"deploy"===e.mode?n("el-select",{staticClass:"ml-10 mr-50",attrs:{size:"small",clearable:"",filterable:""},model:{value:e.packageVersion,callback:function(t){e.packageVersion=t},expression:"packageVersion"}},e._l(e.versionOptions,(function(t){return"deploy"===e.mode?n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}}):e._e()})),1):e._e(),"deploy"===e.mode?n("el-button",{staticClass:"fs-16",attrs:{type:"primary",size:"mini",disabled:!e.packageVersion},on:{click:function(t){return e.clusterOptation("upgrade")}}},[e._v(e._s(e.$t("common.Upgrade")))]):e._e()],1)]),n("div",{staticClass:"node-list"},[n("h3",{staticClass:"mt-15 mb-30"},[e._v(e._s(e.$t("home.ClickHouse Node List")))]),n("div",{staticClass:"search flex flex-between"},[n("el-input",{staticClass:"width-300",attrs:{placeholder:"search",autocomplete:"false",clearable:""},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}}),"deploy"===e.mode?n("el-button",{staticClass:"fs-16",attrs:{type:"primary",size:"mini"},on:{click:e.addNode}},[e._v(e._s(e.$t("manage.Add Node")))]):e._e()],1),n("el-table",{staticClass:"mt-10",attrs:{data:e.list.nodes,border:""}},[n("el-table-column",{attrs:{prop:"ip","show-overflow-tooltip":"",label:e.$t("manage.Node IP"),align:"center"}}),n("el-table-column",{attrs:{prop:"hostname","show-overflow-tooltip":"",label:e.$t("manage.Node Name"),align:"center"}}),n("el-table-column",{attrs:{prop:"shardNumber","show-overflow-tooltip":"",label:e.$t("manage.shard number"),align:"center"}}),n("el-table-column",{attrs:{prop:"replicaNumber","show-overflow-tooltip":"",label:e.$t("manage.replica number"),align:"center"}}),n("el-table-column",{attrs:{prop:"disk","show-overflow-tooltip":"",label:e.$t("manage.Disk(Used/Total)"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.disk)+" ")]}}])}),n("el-table-column",{attrs:{prop:"status","show-overflow-tooltip":"",label:e.$t("manage.Node Status"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{staticClass:"dot mr-5",class:t.row.status}),e._v(e._s(t.row.status)+" ")]}}])}),"deploy"===e.mode?n("el-table-column",{attrs:{label:e.$t("home.Actions"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[[n("i",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.$t("common.Delete"),expression:"$t('common.Delete')"}],staticClass:"fa fa-trash pointer fs-18",on:{click:function(t){return e.remove(a)}}})]]}}],null,!1,796980711)}):e._e()],1)],1)])],1)},r=[],s=n("a34a"),o=n.n(s),i=n("e621");function c(e,t,n){var a=e.length;return n=void 0===n?a:n,!t&&n>=a?e:Object(i["a"])(e,t,n)}var u=c,l="\\ud800-\\udfff",d="\\u0300-\\u036f",f="\\ufe20-\\ufe2f",m="\\u20d0-\\u20ff",p=d+f+m,v="\\ufe0e\\ufe0f",h="\\u200d",b=RegExp("["+h+l+p+v+"]");function g(e){return b.test(e)}var w=g;function $(e){return e.split("")}var k=$,x="\\ud800-\\udfff",C="\\u0300-\\u036f",_="\\ufe20-\\ufe2f",y="\\u20d0-\\u20ff",N=C+_+y,O="\\ufe0e\\ufe0f",D="["+x+"]",S="["+N+"]",j="\\ud83c[\\udffb-\\udfff]",V="(?:"+S+"|"+j+")",M="[^"+x+"]",R="(?:\\ud83c[\\udde6-\\uddff]){2}",T="[\\ud800-\\udbff][\\udc00-\\udfff]",A="\\u200d",P=V+"?",U="["+O+"]?",z="(?:"+A+"(?:"+[M,R,T].join("|")+")"+U+P+")*",B=U+P+z,E="(?:"+[M+S+"?",S,R,T,D].join("|")+")",I=RegExp(j+"(?="+j+")|"+E+B,"g");function L(e){return e.match(I)||[]}var H=L;function J(e){return w(e)?H(e):k(e)}var F=J,q=n("79f6");function G(e){return function(t){t=Object(q["a"])(t);var n=w(t)?F(t):void 0,a=n?n[0]:t.charAt(0),r=n?u(n,1).join(""):t.slice(1);return a[e]()+r}}var K=G,Q=K("toUpperCase"),W=Q,X=K("toLowerCase"),Y=X;function Z(e){return e&&e.length?e[0]:void 0}var ee=Z;function te(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var ne=te,ae=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"add-node"},[n("el-form",{ref:"Form",attrs:{model:e.formModel,"label-width":"150px"}},[n("el-form-item",{attrs:{label:e.$t("manage.New Node IP")+":",prop:"ips"}},[n("el-input",{staticClass:"width-350",attrs:{type:"textarea",placeholder:e.$t("common.placeholderIp")},model:{value:e.formModel.ips,callback:function(t){e.$set(e.formModel,"ips",t)},expression:"formModel.ips"}})],1),n("el-form-item",{attrs:{label:e.$t("manage.Node Shard")+":",prop:"shard"}},[n("el-input-number",{attrs:{step:1,min:e.numberRange[0],max:e.numberRange[1]},model:{value:e.formModel.shard,callback:function(t){e.$set(e.formModel,"shard",t)},expression:"formModel.shard"}})],1)],1)],1)},re=[],se=n("c949"),oe=n("c281");function ie(e,t,n,a,r,s,o){try{var i=e[s](o),c=i.value}catch(u){return void n(u)}i.done?t(c):Promise.resolve(c).then(a,r)}function ce(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var s=e.apply(t,n);function o(e){ie(s,a,r,o,i,"next",e)}function i(e){ie(s,a,r,o,i,"throw",e)}o(void 0)}))}}var ue={props:["numberRange"],data:function(){return{formModel:{ips:"",shard:1}}},methods:{onOk:function(){var e=this;return ce(o.a.mark((function t(){var n,a,r;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.formModel,a=n.ips,r=n.shard,t.next=3,se["a"].addClusterNode(e.$route.params.id,{ips:Object(oe["b"])(Object(oe["c"])(a)),shard:+r});case 3:case"end":return t.stop()}}),t)})))()}}},le=ue,de=n("2877"),fe=Object(de["a"])(le,ae,re,!1,null,null,null),me=fe.exports,pe=n("08ba"),ve=n("8f12");function he(e,t,n,a,r,s,o){try{var i=e[s](o),c=i.value}catch(u){return void n(u)}i.done?t(c):Promise.resolve(c).then(a,r)}function be(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var s=e.apply(t,n);function o(e){he(s,a,r,o,i,"next",e)}function i(e){he(s,a,r,o,i,"throw",e)}o(void 0)}))}}var ge={data:function(){return{mode:"",versionOptions:[{value:"",label:""}],input:"",list:{status:"green",version:"",nodes:[]},clusterStatus:[],packageVersion:""}},mounted:function(){this.clusterStatus=Object.keys(ve["a"]).filter((function(e){return"upgrade"!==e})).map((function(e){return W(e)})),this.fetchVersionData(),this.fetchData()},methods:{fetchData:function(){var e=this;return be(o.a.mark((function t(){var n,a;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,se["a"].getClusterInfo(e.$route.params.id);case 2:n=t.sent,a=n.data.entity,e.list=a,e.mode=a.mode;case 6:case"end":return t.stop()}}),t)})))()},fetchVersionData:function(){var e=this;return be(o.a.mark((function t(){var n,a;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,se["d"].getList();case 2:n=t.sent,a=n.data.entity,e.versionOptions=a.map((function(t){return{value:t,label:t,disabled:t===e.list.version}}));case 5:case"end":return t.stop()}}),t)})))()},isStatusDisable:function(e){return"import"===this.mode||(!(!["start","destroy"].includes(Y(e))||"red"===this.list.status)||"stop"===Y(e)&&"red"===this.list.status)},numberRange:function(){var e=this.list.nodes;e=e.sort((function(e,t){return e.shardNumber-t.shardNumber}));var t=0===e.length?[1,1]:[ee(e).shardNumber,ne(e).shardNumber+1];return t},addNode:function(){var e=this;return be(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(pe["c"])({component:me,props:{title:e.$t("manage.Add Node"),width:600,cancelText:e.$t("common.Cancel"),okText:e.$t("common.Save")},data:{numberRange:e.numberRange()}});case 2:e.$message.success(e.$t("manage.Add Node")+e.$t("common.Success")),e.fetchData();case 4:case"end":return t.stop()}}),t)})))()},remove:function(e){var t=this;return be(o.a.mark((function n(){return o.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log(e),n.next=3,t.$confirm(t.$t("common.Confirm Delete"),t.$t("common.tips"),{confirmButtonText:t.$t("common.Delete"),cancelButtonText:t.$t("common.Cancel"),text:"warning"});case 3:return n.next=5,se["a"].deleteClusterNode(t.$route.params.id,{ip:e.ip});case 5:t.$message.success(t.$t("common.Delete")+t.$t("common.Success")),t.fetchData();case 7:case"end":return n.stop()}}),n)})))()},clusterOptation:function(e){var t=this;return be(o.a.mark((function n(){var a;return o.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e=Y(e),n.next=3,t.$confirm(t.$t("common."+ve["a"][e]),t.$t("common.tips"),{confirmButtonText:t.$t("common.Confirm"),cancelButtonText:t.$t("common.Cancel")});case 3:return pe["b"].increase(),a={clusterName:t.$route.params.id},"upgrade"===e&&(a=Object.assign(a,{packageVersion:t.packageVersion})),n.next=8,se["a"].manageCluster(e,a)["finally"]((function(){return pe["b"].decrease()}));case 8:if(t.$message.success("".concat(t.$t("manage."+W(e)+" Cluster"))+" ".concat(t.$t("common.Success"))),"destroy"!==e){n.next=12;break}return t.$router.push("/home"),n.abrupt("return");case 12:t.fetchData();case 13:case"end":return n.stop()}}),n)})))()}},components:{}},we=ge,$e=(n("933a"),Object(de["a"])(we,a,r,!1,null,"60813c08",null));t["default"]=$e.exports},e621:function(e,t,n){"use strict";function a(e,t,n){var a=-1,r=e.length;t<0&&(t=-t>r?0:r+t),n=n>r?r:n,n<0&&(n+=r),r=t>n?0:n-t>>>0,t>>>=0;var s=Array(r);while(++a<r)s[a]=e[a+t];return s}t["a"]=a}}]);