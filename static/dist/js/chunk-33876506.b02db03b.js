(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-33876506"],{"879f":function(e,t,r){},bb6c:function(e,t,r){"use strict";var n=r("879f"),a=r.n(n);a.a},c308:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("main",{staticClass:"settings"},[r("breadcrumb",{attrs:{data:["Clusters",e.$route.params.id,"manage"]},scopedSlots:e._u([{key:"default",fn:function(){return e._l(e.clusterStatus,(function(t){return r("el-button",{key:t,staticClass:"fs-14",attrs:{type:"primary",size:"mini",disabled:e.isStatusDisable(t)},on:{click:function(r){return e.clusterOptation(t)}}},[e._v(e._s(t)+" Cluster")])}))},proxy:!0}])}),r("section",{staticClass:"container"},[r("div",{staticClass:"uprade ptb-15"},[r("span",{staticClass:"fs-18 font-bold mb-15 inline-block"},[e._v("Upgrade Cluster")]),r("div",{},[r("span",{staticClass:"fs-14 font-bold"},[e._v("ClickHouse Version: "+e._s(e.list.version))]),"deploy"===e.mode?r("span",{staticClass:"fs-14 font-bold ml-50"},[e._v("Upgrade to:")]):e._e(),"deploy"===e.mode?r("el-select",{staticClass:"ml-10 mr-50",attrs:{size:"small",clearable:"",filterable:""},model:{value:e.packageVersion,callback:function(t){e.packageVersion=t},expression:"packageVersion"}},e._l(e.versionOptions,(function(t){return"deploy"===e.mode?r("el-option",{key:t.value,attrs:{label:t.label,value:t.value}}):e._e()})),1):e._e(),"deploy"===e.mode?r("el-button",{staticClass:"fs-16",attrs:{type:"primary",size:"mini",disabled:!e.packageVersion},on:{click:function(t){return e.clusterOptation("upgrade")}}},[e._v("Upgrade")]):e._e()],1)]),r("div",{staticClass:"node-list"},[r("h3",{staticClass:"mt-15 mb-30"},[e._v("ClickHouse Node List")]),r("div",{staticClass:"search flex flex-between"},[r("el-input",{staticClass:"width-300",attrs:{placeholder:"search",autocomplete:"false",clearable:""},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}}),"deploy"===e.mode?r("el-button",{staticClass:"fs-16",attrs:{type:"primary",size:"mini"},on:{click:e.addNode}},[e._v("Add Node")]):e._e()],1),r("el-table",{staticClass:"mt-10",attrs:{data:e.list.nodes,border:""}},[r("el-table-column",{attrs:{prop:"ip","show-overflow-tooltip":"",label:"Node IP",align:"center"}}),r("el-table-column",{attrs:{prop:"hostname","show-overflow-tooltip":"",label:"Node Name",align:"center"}}),r("el-table-column",{attrs:{prop:"shardNumber","show-overflow-tooltip":"",label:"shard number",align:"center"}}),r("el-table-column",{attrs:{prop:"replicaNumber","show-overflow-tooltip":"",label:"replica number",align:"center"}}),r("el-table-column",{attrs:{prop:"status","show-overflow-tooltip":"",label:"Node Status",align:"center"}}),"deploy"===e.mode?r("el-table-column",{attrs:{label:"Actions",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[[r("i",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"Delete",expression:"'Delete'"}],staticClass:"fa fa-trash pointer fs-18",on:{click:function(t){return e.remove(n)}}})]]}}],null,!1,3894504743)}):e._e()],1)],1)])],1)},a=[],o=r("a34a"),s=r.n(o),i=r("e621");function u(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:Object(i["a"])(e,t,r)}var l=u,c="\\ud800-\\udfff",f="\\u0300-\\u036f",d="\\ufe20-\\ufe2f",p="\\u20d0-\\u20ff",m=f+d+p,v="\\ufe0e\\ufe0f",h="\\u200d",b=RegExp("["+h+c+m+v+"]");function w(e){return b.test(e)}var g=w;function y(e){return e.split("")}var x=y,k="\\ud800-\\udfff",C="\\u0300-\\u036f",_="\\ufe20-\\ufe2f",N="\\u20d0-\\u20ff",O=C+_+N,$="\\ufe0e\\ufe0f",S="["+k+"]",j="["+O+"]",D="\\ud83c[\\udffb-\\udfff]",M="(?:"+j+"|"+D+")",A="[^"+k+"]",V="(?:\\ud83c[\\udde6-\\uddff]){2}",R="[\\ud800-\\udbff][\\udc00-\\udfff]",T="\\u200d",E=M+"?",I="["+$+"]?",P="(?:"+T+"(?:"+[A,V,R].join("|")+")"+I+E+")*",U=I+E+P,z="(?:"+[A+j+"?",j,V,R,S].join("|")+")",B=RegExp(D+"(?="+D+")|"+z+U,"g");function L(e){return e.match(B)||[]}var H=L;function J(e){return g(e)?H(e):x(e)}var F=J,q=r("79f6");function G(e){return function(t){t=Object(q["a"])(t);var r=g(t)?F(t):void 0,n=r?r[0]:t.charAt(0),a=r?l(r,1).join(""):t.slice(1);return n[e]()+a}}var K=G,Q=K("toUpperCase"),W=Q,X=K("toLowerCase"),Y=X;function Z(e){return e&&e.length?e[0]:void 0}var ee=Z;function te(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var re=te,ne=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"add-node"},[r("el-form",{ref:"Form",attrs:{model:e.formModel,"label-width":"150px"}},[r("el-form-item",{attrs:{label:"New Node IP:",prop:"ip"}},[r("el-input",{staticClass:"width-350",model:{value:e.formModel.ip,callback:function(t){e.$set(e.formModel,"ip",t)},expression:"formModel.ip"}})],1),r("el-form-item",{attrs:{label:"Node Shard:",prop:"shard"}},[r("el-input-number",{attrs:{step:1,min:e.numberRange[0],max:e.numberRange[1]},model:{value:e.formModel.shard,callback:function(t){e.$set(e.formModel,"shard",t)},expression:"formModel.shard"}})],1)],1)],1)},ae=[],oe=r("c949");function se(e,t,r,n,a,o,s){try{var i=e[o](s),u=i.value}catch(l){return void r(l)}i.done?t(u):Promise.resolve(u).then(n,a)}function ie(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function s(e){se(o,n,a,s,i,"next",e)}function i(e){se(o,n,a,s,i,"throw",e)}s(void 0)}))}}var ue={props:["numberRange"],data:function(){return{formModel:{ip:"",shard:1}}},methods:{onOk:function(){var e=this;return ie(s.a.mark((function t(){var r,n,a;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.formModel,n=r.ip,a=r.shard,t.next=3,oe["a"].addClusterNode(e.$route.params.id,{ip:n,shard:+a});case 3:case"end":return t.stop()}}),t)})))()}}},le=ue,ce=r("2877"),fe=Object(ce["a"])(le,ne,ae,!1,null,null,null),de=fe.exports,pe=r("08ba"),me=r("8f12");function ve(e,t){return ye(e)||ge(e,t)||be(e,t)||he()}function he(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function be(e,t){if(e){if("string"===typeof e)return we(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?we(e,t):void 0}}function we(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ge(e,t){var r=e&&("undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=r){var n,a,o=[],s=!0,i=!1;try{for(r=r.call(e);!(s=(n=r.next()).done);s=!0)if(o.push(n.value),t&&o.length===t)break}catch(u){i=!0,a=u}finally{try{s||null==r["return"]||r["return"]()}finally{if(i)throw a}}return o}}function ye(e){if(Array.isArray(e))return e}function xe(e,t,r,n,a,o,s){try{var i=e[o](s),u=i.value}catch(l){return void r(l)}i.done?t(u):Promise.resolve(u).then(n,a)}function ke(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function s(e){xe(o,n,a,s,i,"next",e)}function i(e){xe(o,n,a,s,i,"throw",e)}s(void 0)}))}}var Ce={data:function(){return{mode:"",versionOptions:[{value:"",label:""}],input:"",list:{status:"green",version:"",nodes:[]},clusterStatus:[],packageVersion:""}},mounted:function(){this.clusterStatus=Object.keys(me["a"]).filter((function(e){return"upgrade"!==e})).map((function(e){return W(e)})),this.fetchModeData(),this.fetchVersionData(),this.fetchData()},methods:{fetchData:function(){var e=this;return ke(s.a.mark((function t(){var r,n;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,oe["a"].getClusterInfo(e.$route.params.id);case 2:r=t.sent,n=r.data.entity,e.list=n;case 5:case"end":return t.stop()}}),t)})))()},fetchVersionData:function(){var e=this;return ke(s.a.mark((function t(){var r,n;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,oe["d"].getList();case 2:r=t.sent,n=r.data.entity,e.versionOptions=n.map((function(t){return{value:t,label:t,disabled:t===e.list.version}}));case 5:case"end":return t.stop()}}),t)})))()},fetchModeData:function(){var e=this;return ke(s.a.mark((function t(){var r,n;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,oe["a"].getCluster();case 2:r=t.sent,n=r.data.entity,Object.entries(n).forEach((function(t){var r=ve(t,2),n=(r[0],r[1]);n.cluster===e.$route.params.id&&(e.mode=n.mode)})),console.log("mode:",e.mode);case 6:case"end":return t.stop()}}),t)})))()},isStatusDisable:function(e){return"import"===this.mode||(!(!["start","destroy"].includes(Y(e))||"red"===this.list.status)||"stop"===Y(e)&&"red"===this.list.status)},numberRange:function(){var e=this.list.nodes;e=e.sort((function(e,t){return e.shardNumber-t.shardNumber}));var t=0===e.length?[1,1]:[ee(e).shardNumber,re(e).shardNumber+1];return t},addNode:function(){var e=this;return ke(s.a.mark((function t(){return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(pe["b"])({component:de,props:{title:"Add Node",width:600,cancelText:"Cancel",okText:"Save"},data:{numberRange:e.numberRange()}});case 2:e.$message.success("node节点添加成功"),e.fetchData();case 4:case"end":return t.stop()}}),t)})))()},remove:function(e){var t=this;return ke(s.a.mark((function r(){return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log(e),r.next=3,t.$confirm("Confirm whether to delete ?","Tip",{confirmButtonText:"Delete",cancelButtonText:"Cancel",text:"warning"});case 3:return r.next=5,oe["a"].deleteClusterNode(t.$route.params.id,{ip:e.ip});case 5:t.$message.success("删除成功"),t.fetchData();case 7:case"end":return r.stop()}}),r)})))()},clusterOptation:function(e){var t=this;return ke(s.a.mark((function r(){var n;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e=Y(e),r.next=3,t.$confirm("确认要进行 ".concat(me["a"][e]," 操作么"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消"});case 3:return pe["a"].increase(),n={clusterName:t.$route.params.id},"upgrade"===e&&(n=Object.assign(n,{packageVersion:t.packageVersion})),r.next=8,oe["a"].manageCluster(e,n)["finally"]((function(){return pe["a"].decrease()}));case 8:t.$message.success("集群".concat(me["a"][e],"成功")),t.fetchData();case 10:case"end":return r.stop()}}),r)})))()}},components:{}},_e=Ce,Ne=(r("bb6c"),Object(ce["a"])(_e,n,a,!1,null,"4b0afd11",null));t["default"]=Ne.exports},e621:function(e,t,r){"use strict";function n(e,t,r){var n=-1,a=e.length;t<0&&(t=-t>a?0:a+t),r=r>a?a:r,r<0&&(r+=a),a=t>r?0:r-t>>>0,t>>>=0;var o=Array(a);while(++n<a)o[n]=e[n+t];return o}t["a"]=n}}]);